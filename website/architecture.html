<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLightSFTP Architecture Guide</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="icon.png">
</head>
<body>
    <div class="main-content-wrapper">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <img src="icon.png" alt="SLightSFTP Logo" class="logo">
                    <span>SLightSFTP</span>
                    <span class="free-badge">FREE</span>
                </div>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#stack">Stack</a></li>
                    <li><a href="#flows">Data Flows</a></li>
                    <li><a href="#topologies">Topologies</a></li>
                    <li><a href="#models">Data Model</a></li>
                    <li><a href="#ports">Ports</a></li>
                    <li><a href="#lifecycle">Lifecycle</a></li>
                    <li><a href="#config">Config</a></li>
                    <li><a href="#backup">Backup</a></li>
                </ul>
            </div>
        </nav>

        <section class="architecture" id="stack">
            <div class="container">
                <h2>Architecture Stack</h2>
                <p class="section-intro">High-level layers for Desktop (Electron) and Web Server modes.</p>
                <div class="architecture-grid">
                    <div class="architecture-card">
                        <h3>Desktop Mode</h3>
                        <ul>
                            <li>Electron shell renders GUI</li>
                            <li>Node.js orchestrates listeners via IPC</li>
                            <li>SFTP/FTP listeners share same core</li>
                            <li>SQLite DB for settings, users, activity</li>
                            <li>Tray app keeps services running headless</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Web Mode</h3>
                        <ul>
                            <li>Node.js service exposes REST + WebSocket</li>
                            <li>Browser UI served statically</li>
                            <li>Same DB schema as Desktop</li>
                            <li>Good for headless servers / labs</li>
                            <li>Pairs with reverse proxy for TLS</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Security Layers</h3>
                        <ul>
                            <li>Password + SSH public key auth</li>
                            <li>Per-listener permissions and virtual paths</li>
                            <li>Idle timeout safety (5 minutes)</li>
                            <li>Audit logging with IP + auth method</li>
                        </ul>
                    </div>
                </div>

                <div class="diagram-wrapper">
<pre class="diagram">
Desktop (Electron)
+----------------+     +------------------+     +--------------------+
| Electron GUI   | --> | Node Controller  | --> | SFTP/FTP Listeners |
| (HTML/JS)      |     | (IPC + WebSocket)|     | (22/21/custom)     |
+----------------+     +------------------+     +--------------------+
         |                      |                         |
         v                      v                         v
    Settings UI           SQLite Database           Virtual Paths
</pre>
<pre class="diagram">
Web Server Mode
Browser --> Web UI --> REST/WebSocket --> Core Server --> Listeners --> Storage
</pre>
                </div>
            </div>
        </section>

        <section class="architecture" id="ports">
            <div class="container">
                <h2>Port Map</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Defaults</h3>
                        <ul>
                            <li>SFTP: 22</li>
                            <li>FTP: 21 + passive range (configurable)</li>
                            <li>Web GUI: 3000</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Recommendations</h3>
                        <ul>
                            <li>Use non-privileged alternate ports when running un-elevated</li>
                            <li>Separate DMZ and internal listeners</li>
                            <li>Document passive port range and open only that range</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Reverse Proxy</h3>
                        <ul>
                            <li>Front Web GUI with IIS/NGINX for TLS</li>
                            <li>Keep proxy on 443, forward to 3000</li>
                            <li>Limit admin IPs at proxy and firewall</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="flows">
            <div class="container">
                <h2>Key Data Flows</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Authentication Flow</h3>
<pre class="diagram">
Client --> Listener --> Auth Service --> DB (users, keys) --> Result
               |             |
          IP + method    Audit log row
</pre>
                    </div>
                    <div class="architecture-card">
                        <h3>File I/O Flow</h3>
<pre class="diagram">
Client --> Listener --> Virtual Path Resolver --> Local FS --> Result
                       |-> Permission Check
</pre>
                    </div>
                    <div class="architecture-card">
                        <h3>Activity Logging</h3>
<pre class="diagram">
Operation --> Event Bus --> Activity Table --> UI/CSV Export
</pre>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="lifecycle">
            <div class="container">
                <h2>Process Lifecycle</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Desktop Start</h3>
                        <ol>
                            <li>Electron launches and loads GUI</li>
                            <li>Node controller initializes DB and listeners</li>
                            <li>Tray icon created; Web GUI toggles available</li>
                        </ol>
                    </div>
                    <div class="architecture-card">
                        <h3>Web Mode Start</h3>
                        <ol>
                            <li><code>npm run start:web</code> boots API + GUI server</li>
                            <li>Listeners start if enabled</li>
                            <li>WebSocket pushes stats to browser</li>
                        </ol>
                    </div>
                    <div class="architecture-card">
                        <h3>Shutdown</h3>
                        <ul>
                            <li>Stop listeners (drain active sessions)</li>
                            <li>Flush pending activity log writes</li>
                            <li>Close DB cleanly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="topologies">
            <div class="container">
                <h2>Deployment Topologies</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Single Node</h3>
                        <ul>
                            <li>Desktop or Web mode on one Windows host</li>
                            <li>DMZ exposure via firewall rule</li>
                            <li>Backups: copy SQLite DB + config directory</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Split Roles</h3>
                        <ul>
                            <li>Web GUI on port 3000 behind reverse proxy</li>
                            <li>SFTP on 22, FTP on 21 or custom</li>
                            <li>Restrict passive FTP range at firewall</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Partner DMZ + Internal</h3>
                        <ul>
                            <li>DMZ listener for partners (key-only)</li>
                            <li>Internal listener for LAN users</li>
                            <li>Separate virtual paths per audience</li>
                            <li>Rotate keys regularly; log exports weekly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="models">
            <div class="container">
                <h2>Data Model Notes</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Tables</h3>
                        <ul>
                            <li>Users: credentials, SSH keys, role flags</li>
                            <li>Listeners: protocol, port, bind IP, status</li>
                            <li>Virtual Paths: virtual -> local mapping, permissions</li>
                            <li>Activity: timestamp, user, verb, path, result, IP</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Integrity</h3>
                        <ul>
                            <li>Listener assignments reference user IDs</li>
                            <li>Virtual path permissions scoped per listener</li>
                            <li>Activity rows immutable; exportable as CSV</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Backups</h3>
                        <ul>
                            <li>Stop service ➜ copy DB file ➜ start service</li>
                            <li>Keep 7-day rolling backups</li>
                            <li>Test restore on a staging VM monthly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="config">
            <div class="container">
                <h2>Configuration Surfaces</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>GUI</h3>
                        <ul>
                            <li>Listeners: protocol, port, bind IP</li>
                            <li>Users: password/key auth, permissions, virtual paths</li>
                            <li>Web server toggle and port</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Env / CLI</h3>
                        <ul>
                            <li><code>WEB_PORT</code>: override web GUI port</li>
                            <li>Passive FTP range: set in config/env then mirror firewall</li>
                            <li>Service-friendly: wrap <code>npm run start:web</code> as Windows service</li>
                        </ul>
                    </div>
                    <div class="architecture-card">
                        <h3>Filesystem</h3>
                        <ul>
                            <li>Data directory holds SQLite DB</li>
                            <li>Virtual paths map to local folders you choose</li>
                            <li>Keep data path on SSD/NVMe for throughput</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="architecture" id="backup">
            <div class="container">
                <h2>Backup & Restore</h2>
                <div class="architecture-subgrid">
                    <div class="architecture-card">
                        <h3>Backup</h3>
                        <ol>
                            <li>Stop service/app</li>
                            <li>Copy SQLite DB file and config directory</li>
                            <li>Store off-box with 7-day rotation</li>
                        </ol>
                    </div>
                    <div class="architecture-card">
                        <h3>Restore</h3>
                        <ol>
                            <li>Stop service/app</li>
                            <li>Replace DB with backup copy</li>
                            <li>Start app; verify listeners and users</li>
                        </ol>
                    </div>
                    <div class="architecture-card">
                        <h3>Test</h3>
                        <ul>
                            <li>Run monthly restore drill on a staging VM</li>
                            <li>Validate log history and user keys</li>
                            <li>Document steps for operators</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="container">
                <div class="footer-bottom">
                    <p>&copy; 2025 SLightSFTP Server. Free and Open Source Software.</p>
                    <p><a href="index.html">Back to Home</a></p>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>
